#!/bin/sh

hostname="Hostname...: $(hostname)"
ext_ip="Internal IP: $(ip route get 1 |
                       grep -oE '192\.168(\.[0-9]{1,3}){2}' |
                       grep -v '^192\.168\.1\.1$')"
int_ip="External IP: $(curl -s https://icanhazip.com)"
time="Time.......: $(date +%r)"
date="Date.......: $(date +"%a, %b %e, %Y")"
w_url='http://rss.accuweather.com/rss/liveweather_rss.asp?metric=2&locCode=NAM|US|MO|LAKE%20SAINT%20LOUIS'
w_sed='/Currently:/ s/.*: (.*): ([0-9]+)F.*/\2F, \1/p'
weather="Weather....: $(curl -s "$w_url" | sed -rn "$w_sed")"

in_box="${hostname}\n${int_ip}\n${ext_ip}\n${time}\n${date}\n${weather}"
info="$(echo "$in_box" | boxes -d parchment -p h2)"

ssh_header="
             8
           .d8b.
       _.d8888888b._
     .88888888888888b.
    d88888888888888888b
    8888888888888888888        $(echo "$info" | sed -n '1{p;q}')
    Y88888888888888888P        $(echo "$info" | sed -n '2{p;q}')
     'Y8888888888888P'         $(echo "$info" | sed -n '3{p;q}')
   _..._ 'Y88888P' _..._       $(echo "$info" | sed -n '4{p;q}')
 .d88889b. Y888P .d88888b.     $(echo "$info" | sed -n '5{p;q}')
d888888888b 888 d88888888b     $(echo "$info" | sed -n '6{p;q}')
888P  \`Y8888888888P'  Y888     $(echo "$info" | sed -n '7{p;q}')
 b8b    Y88888888P    d8Y      $(echo "$info" | sed -n '8{p;q}')
  \`\"'  #############  '\"\`      $(echo "$info" | sed -n '9{p;q}')
         dP d8b Yb             $(echo "$info" | sed -n '10{p;q}')
     Ob=dP d888b Yb=dO
      \`\"\` O88888O \`\"\`
   jgs     'Y8P'
             '
     by: Joan G. Stark
"

# Pad each line with trailing spaces so that they are the same length
longest="$(echo "$ssh_header" | awk '{print length}' | sort -n | tail -1)"
ssh_header="$(
    echo "$ssh_header" | while IFS= read -r line; do
        len="$(echo "$line" | awk '{print length}')"
        spaces="$(printf "%$((longest-len))s")"
        echo "${line}${spaces}"
    done
)"

# Center ssh_header horizontally and give it color
echo "$ssh_header" | figlet -ctf term | /usr/games/lolcat -f
